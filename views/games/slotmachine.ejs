<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="/css/cut.css" />
    <link rel="stylesheet" href="/css/slotmachine.css" />
    <link rel="shortcut icon" href="/img/favicon.png" type="image/x-icon" />
  </head>
  <body>
    <div class="gridcont">
      <div class="item item-2">
        <!-- Bootstrap -->
        <div class="btn-group">
          <button
            class="ddbtn cont"
            type="button"
            data-bs-toggle="dropdown"
            data-bs-auto-close="outside"
            aria-expanded="false"
          >
            <img src="/img/userAvatar.png" alt="" />
          </button>
          <ul class="dropdown-menu dropdown-menu-dark">
            <li class="accountdetail">
              <img src="/img/userAvatar.png" alt="" />
              <div>
                <span></span>
                <span></span>
              </div>
            </li>
            <li><hr class="dropdown-divider" /></li>
            <li>
              <span class="dropdown-item"
                ><i class="fa-solid fa-user"></i><a>Fiók</a></span
              >
            </li>
            <li>
              <div class="dropstart dropdown-item">
                <button
                  class="ddbtn"
                  type="button"
                  data-bs-toggle="dropdown"
                  data-bs-offset="0, 9"
                  aria-expanded="false"
                >
                  <i class="fa-solid fa-cloud-moon"></i
                  ><a style="color: var(--bs-dropdown-link-color)">Téma</a>
                </button>
                <ul class="dropdown-menu dropdown-menu-dark">
                  <li>
                    <span class="dropdown-item" onclick="themeChange(this)"
                      ><i class="fa-solid fa-cloud-moon"></i><a>Sötét</a
                      ><i class="fa-solid fa-check"></i
                    ></span>
                  </li>
                  <li>
                    <span class="dropdown-item" onclick="themeChange(this)"
                      ><i class="fa-solid fa-sun"></i><a>Világos</a></span
                    >
                  </li>
                  <li>
                    <span class="dropdown-item" onclick="themeChange(this)"
                      ><i class="fa-solid fa-gears"></i><a>Auto</a></span
                    >
                  </li>
                </ul>
              </div>
            </li>
            <li>
              <span class="dropdown-item"
                ><i class="fa-solid fa-dollar-sign"></i
                ><a id="dropdownCurrency">Egyenleg: </a></span
              >
            </li>
          </ul>
        </div>
      </div>

      <div class="appcont">
        <div class="app">
          <div class="rowrow">
            <div class="doors">
              <div class="door" data-last-displayed="4">
                <div class="boxes"></div>
              </div>

              <div class="door" data-last-displayed="4">
                <div class="boxes"></div>
              </div>

              <div class="door" data-last-displayed="4">
                <div class="boxes"></div>
              </div>
            </div>
            <div id="leverControl" class="lever-control">
              <div class="lever">
                <div class="knob"></div>
                <div class="stick"></div>
              </div>
              <div class="lever-base">
                <div class="pivot"></div>
              </div>
            </div>
          </div>
          <img src="/img/slot/jackpotMachine.png" alt="" />
          <img src="/img/slot/jackpotStickBase.png" alt="" />
        </div>

        <section>
          <div class="info">
            <button class="openPopup">
              <i class="fa-solid fa-question"></i>
            </button>
          </div>

          <div class="popup-outer none" onclick="del()">
            <div class="popup-box">
              <i class="fa-solid fa-xmark close"></i>
              <table>
                <tbody>
                  <tr>
                    <th>Symbols</th>
                    <th>2x</th>
                    <th>3x</th>
                  </tr>
                  <tr>
                    <td>🗿</td>
                    <td>200%</td>
                    <td>500%</td>
                  </tr>
                  <tr>
                    <td>💸</td>
                    <td>150%</td>
                    <td>800%</td>
                  </tr>
                  <tr>
                    <td>📉</td>
                    <td>60%</td>
                    <td>20%</td>
                  </tr>
                  <tr>
                    <td>💩</td>
                    <td>30%</td>
                    <td>5%</td>
                  </tr>
                  <tr>
                    <td>👎</td>
                    <td>50%</td>
                    <td>30%</td>
                  </tr>
                  <tr>
                    <td>🍀</td>
                    <td>400%</td>
                    <td>1000%</td>
                  </tr>
                  <tr>
                    <td>💰</td>
                    <td>200%</td>
                    <td>900%</td>
                  </tr>
                  <tr>
                    <td>🍣</td>
                    <td>120%</td>
                    <td>250%</td>
                  </tr>
                  <tr>
                    <td>❌</td>
                    <td>5%</td>
                    <td>0%</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <div class="inters">
          <div class="rowrow">
            <div class="inf">
              <span>Egyenleg:</span>
              <span class="currency"></span>
            </div>
            <div class="inf">
              <span>Tét: (Max: 20000 Ft)</span>
              <input
                class="bet"
                type="number"
                min="1000"
                max="20000"
                value="1000"
                placeholder="Tét"
              />
            </div>
          </div>

          <div class="rowrow">
            <button class="onebet">+1000</button>
            <button class="maxbet">Max tét</button>
            <button class="spin">Pörgetés</button>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
    crossorigin="anonymous"
  ></script>
  <script
    src="https://kit.fontawesome.com/f359bbbf40.js"
    crossorigin="anonymous"
  ></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/gsap.min.js"></script>
  <script>
    /* popup */
    const section = document.querySelector("section");
    let isMouseOver = false;

    document.querySelector(".popup-box").addEventListener(
      "mouseleave",
      () => {
        isMouseOver = false;
      },
      false
    );

    document.querySelector(".popup-box").addEventListener(
      "mouseover",
      () => {
        isMouseOver = true;
      },
      false
    );

    document.querySelector(".openPopup").addEventListener("click", () => {
      section.classList.add("show");
    });

    document.querySelector(".close").addEventListener("click", () => {
      section.classList.remove("show");
    });

    function del() {
      if (!isMouseOver) section.classList.remove("show");
    }
    /* popup end */

    if (
      sessionStorage.getItem("username") != "" &&
      sessionStorage.getItem("username") != null
    ) {
      document.querySelector(
        ".accountdetail"
      ).children[1].children[0].innerHTML = sessionStorage.getItem("username");
      document.querySelector(
        ".accountdetail"
      ).children[1].children[1].innerHTML =
        "@" + sessionStorage.getItem("emailadress").split("@")[0];
    } else {
      //location.href = "/"
    }
    var currency = document.querySelector(".currency");
    var bet = document.querySelector(".bet");
    const doors = document.querySelectorAll(".door");
    document.querySelector("#dropdownCurrency").innerHTML += 50000;
    currency.innerHTML = 50000;

    function checkwin() {
      var dict = {
        "🗿": 0,
        "💸": 0,
        "📉": 0,
        "💩": 0,
        "👎": 0,
        "🍀": 0,
        "💰": 0,
        "🍣": 0,
        "❌": 0
      };

      for (var door of doors) {
        for (var key in dict) {
          if (key == door.dataset.lastDisplayed) {
            dict[key] = dict[key] + 1;
          }
        }
      }

      var items = Object.keys(dict).map(function(key) {
        return [key, dict[key]];
      });

      items.sort(function(a, b) {
        return b[1] - a[1];
      });

      console.log(items[0]);

      if (items[0][1] == 2) {
        if (items[0][0] == "🗿")
          currency.innerHTML = currency.innerHTML * 1 + bet.value * 2;
        else if (items[0][0] == "💸")
          currency.innerHTML = currency.innerHTML * 1 + bet.value * 1.5;
        else if (items[0][0] == "📉")
          currency.innerHTML = currency.innerHTML * 1 + bet.value * 0.6;
        else if (items[0][0] == "💩")
          currency.innerHTML = currency.innerHTML * 1 + bet.value * 0.3;
        else if (items[0][0] == "👎")
          currency.innerHTML = currency.innerHTML * 1 + bet.value * 0.5;
        else if (items[0][0] == "🍀")
          currency.innerHTML = currency.innerHTML * 1 + bet.value * 4;
        else if (items[0][0] == "💰")
          currency.innerHTML = currency.innerHTML * 1 + bet.value * 2;
        else if (items[0][0] == "🍣")
          currency.innerHTML = currency.innerHTML * 1 + bet.value * 1.2;
        else if (items[0][0] == "❌")
          currency.innerHTML = currency.innerHTML * 1 + bet.value * 0.05;
      }

      if (items[0][1] == 3) {
        if (items[0][0] == "🗿")
          currency.innerHTML = currency.innerHTML * 1 + bet.value * 5;
        else if (items[0][0] == "💸")
          currency.innerHTML = currency.innerHTML * 1 + bet.value * 8;
        else if (items[0][0] == "📉")
          currency.innerHTML = currency.innerHTML * 1 + bet.value * 0.2;
        else if (items[0][0] == "💩")
          currency.innerHTML = currency.innerHTML * 1 + bet.value * 0.05;
        else if (items[0][0] == "👎")
          currency.innerHTML = currency.innerHTML * 1 + bet.value * 0.3;
        else if (items[0][0] == "🍀")
          currency.innerHTML = currency.innerHTML * 1 + bet.value * 10;
        else if (items[0][0] == "💰")
          currency.innerHTML = currency.innerHTML * 1 + bet.value * 9;
        else if (items[0][0] == "🍣")
          currency.innerHTML = currency.innerHTML * 1 + bet.value * 2.5;
      }
    }

    const leverControl = document.querySelector(".lever-control");
    var animationRunning = false;

    const items = ["🗿", "💸", "📉", "💩", "👎", "🍀", "💰", "🍣", "❌"];

    async function spin() {
      init(1, 2);
      for (const door of doors) {
        const boxes = door.querySelector(".boxes");
        const duration = parseInt(boxes.style.transitionDuration);
        boxes.style.transform = "translateY(0)";
        await new Promise(resolve => setTimeout(resolve, duration * 100));
      }
    }

    function init(groups = 1, duration = 1) {
      for (const door of doors) {
        const boxes = door.querySelector(".boxes");
        const boxesClone = boxes.cloneNode(false);

        const pool = [door.dataset.lastDisplayed];

        const arr = [];
        for (let n = 0; n < (groups > 0 ? groups : 1); n++) {
          arr.push(...items);
        }
        pool.push(...shuffle(arr));
        boxesClone.addEventListener("transitionstart", function() {
          this.querySelectorAll(".box").forEach(box => {
            box.style.filter = "blur(1px)";
          });
        });
        boxesClone.addEventListener("transitionend", function() {
          this.querySelectorAll(".box").forEach((box, index) => {
            box.style.filter = "blur(0)";
            if (index > 0) this.removeChild(box);
          });
          door.dataset.lastDisplayed = door.querySelector(".box").innerHTML;
        });
        for (let i = pool.length - 1; i >= 0; i--) {
          const box = document.createElement("div");
          box.classList.add("box");
          box.style.width = door.clientWidth + "px";
          box.style.height = door.clientHeight + "px";
          box.textContent = pool[i];
          boxesClone.appendChild(box);
        }
        boxesClone.style.transitionDuration = `${duration > 0 ? duration : 1}s`;
        boxesClone.style.transform = `translateY(-${door.clientHeight *
          (pool.length - 1)}px)`;
        door.replaceChild(boxesClone, boxes);
      }
    }

    function shuffle([...arr]) {
      let m = arr.length;
      while (m) {
        const i = Math.floor(Math.random() * m--);
        [arr[m], arr[i]] = [arr[i], arr[m]];
      }
      return arr;
    }
    init();

    document.querySelector(".onebet").addEventListener("click", () => {
      if (bet.value * 1 <= 19000) {
        bet.value = bet.value * 1 + 1000;
      }
    });

    document.querySelector(".maxbet").addEventListener("click", () => {
      if (currency.innerHTML * 1 < 20000) bet.value = currency.innerHTML;
      else bet.value = 20000;
    });

    function themeChange(btn) {
      var r = document.querySelector(":root");
      // change where the check icon is
      document.querySelector(".fa-check").remove();
      var i = document.createElement("i");
      i.classList.add("fa-solid");
      i.classList.add("fa-check");
      btn.appendChild(i);

      if (btn.children[1].innerHTML == "Világos") {
        light();
      } else if (btn.children[1].innerHTML == "Sötét") {
        dark();
      } else {
        if (
          window.matchMedia &&
          window.matchMedia("(prefers-color-scheme: dark)").matches
        ) {
          dark();
        } else if (window.matchMedia) {
          light();
        }
      }

      function dark() {
        r.style.setProperty("--bgcolor", "rgba(25, 31, 35, 1)");
        r.style.setProperty("--fontcolor", "white");
        r.style.setProperty("--dropdown-iconcolor", "#9d9d9d");
        r.style.setProperty("--hovercolor", "rgb(34, 41, 46)");
        document
          .querySelectorAll(".dropdown-menu")
          .forEach(e => e.classList.add("dropdown-menu-dark"));
      }

      function light() {
        r.style.setProperty("--bgcolor", "rgb(211, 211, 211)");
        r.style.setProperty("--fontcolor", "black");
        r.style.setProperty("--dropdown-iconcolor", "#5f5f5f");
        r.style.setProperty("--hovercolor", "rgb(192, 192, 192)");
        document
          .querySelectorAll(".dropdown-menu")
          .forEach(e => e.classList.remove("dropdown-menu-dark"));
      }
    }

    document.querySelector(".spin").addEventListener("click", () => {
      if (
        currency.innerHTML * 1 >= bet.value &&
        bet.value >= 1000 &&
        bet.value <= 20000
      ) {
        if (!animationRunning) {
          currency.innerHTML = currency.innerHTML * 1 - bet.value;
          animationRunning = true;
          spin();
          gsap.fromTo(
            ".lever",
            { rotate: -70 },
            {
              rotate: 70,
              duration: ".8",
              repeat: 0,
              ease: "Sine.out"
            }
          );
          setTimeout(() => {
            gsap.fromTo(
              ".lever",
              {
                rotate: 70
              },
              {
                rotate: -70,
                duration: ".4",
                repeat: 0,
                ease: "Sine.out"
              }
            );
          }, 1200);
          setTimeout(() => {
            checkwin();
            animationRunning = false;
          }, 2500);
        }
      } else if (bet.value <= 1000 || bet.value >= 20000) {
        shake(bet);
      } else if (!animationRunning) {
        shake(currency);
      }
    });

    function shake(element) {
      if (!element.classList.contains("animation")) {
        element.classList.add("animation");
        setTimeout(() => {
          element.classList.remove("animation");
        }, 400);
      }
    }
  </script>
</html>
